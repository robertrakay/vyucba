<!-- Pomodoro Timer Include -->
<div id="pomodoro-timer">
  <h3>Pomodoro Timer</h3>
  <div id="timer-display">25:00</div>
  <div id="mode-display">Work</div>
  <div id="pomodoro-controls">
    <button id="start-btn">Start</button>
    <button id="pause-btn">Pause</button>
    <button id="reset-btn">Reset</button>
  </div>
  <div id="progress-bar"><div id="progress"></div></div>
</div>

<style>
#pomodoro-timer {
  position: fixed;
  top: 100px;
  right: 10px;
  width: 180px;
  background: #f2f2f2;
  border: 1px solid #ccc;
  padding: 10px;
  z-index: 999;
  font-family: sans-serif;
  border-radius: 5px;
  text-align: center;
}

#timer-display {
  font-size: 2em;
  margin: 10px 0;
}

#mode-display {
  font-weight: bold;
  margin-bottom: 10px;
}

#pomodoro-controls button {
  margin: 2px;
  padding: 5px 10px;
  cursor: pointer;
}

#progress-bar {
  width: 100%;
  height: 8px;
  background: #ddd;
  border-radius: 4px;
  margin-top: 10px;
}

#progress {
  height: 100%;
  width: 0%;
  background: #007acc;
  border-radius: 4px;
}
</style>

<script>
(function(){
  const timerDisplay = document.getElementById('timer-display');
  const modeDisplay = document.getElementById('mode-display');
  const startBtn = document.getElementById('start-btn');
  const pauseBtn = document.getElementById('pause-btn');
  const resetBtn = document.getElementById('reset-btn');
  const progressBar = document.getElementById('progress');

  // Pomodoro settings
  const workTime = 25*60;       // 25 min
  const shortBreak = 5*60;      // 5 min
  const longBreak = 15*60;      // 15 min
  const cyclesBeforeLongBreak = 4;

  // Load state from localStorage
  let duration = parseInt(localStorage.getItem('pomodoroTime')) || workTime;
  let mode = localStorage.getItem('pomodoroMode') || 'Work';
  let isRunning = localStorage.getItem('pomodoroRunning') === 'true';
  let completedCycles = parseInt(localStorage.getItem('pomodoroCycles')) || 0;
  let timer = null;

  modeDisplay.textContent = mode;
  timerDisplay.textContent = formatTime(duration);
  updateProgress();

  function formatTime(seconds){
    const m = Math.floor(seconds/60).toString().padStart(2,'0');
    const s = (seconds%60).toString().padStart(2,'0');
    return `${m}:${s}`;
  }

  function updateProgress(){
    let total = (mode === 'Work') ? workTime : (mode === 'Short Break' ? shortBreak : longBreak);
    let percent = ((total - duration)/total)*100;
    progressBar.style.width = percent + '%';
  }

  function switchMode(){
    if(mode === 'Work'){
      completedCycles++;
      localStorage.setItem('pomodoroCycles', completedCycles);
      mode = (completedCycles % cyclesBeforeLongBreak === 0) ? 'Long Break' : 'Short Break';
      duration = (mode === 'Short Break') ? shortBreak : longBreak;
    } else {
      mode = 'Work';
      duration = workTime;
    }
    modeDisplay.textContent = mode;
    localStorage.setItem('pomodoroMode', mode);
    localStorage.setItem('pomodoroTime', duration);
    updateProgress();
  }

  function startTimer(){
    if(timer) return;
    isRunning = true;
    localStorage.setItem('pomodoroRunning', 'true');
    timer = setInterval(()=>{
      if(duration > 0){
        duration--;
        timerDisplay.textContent = formatTime(duration);
        localStorage.setItem('pomodoroTime', duration);
        updateProgress();
      } else {
        clearInterval(timer);
        timer = null;
        isRunning = false;
        localStorage.setItem('pomodoroRunning', 'false');
        alert(`${mode} finished!`);
        switchMode();
        startTimer();
      }
    }, 1000);
  }

  function pauseTimer(){
    if(timer){
      clearInterval(timer);
      timer = null;
      isRunning = false;
      localStorage.setItem('pomodoroRunning', 'false');
    }
  }

  function resetTimer(){
    pauseTimer();
    duration = (mode === 'Work') ? workTime : (mode === 'Short Break' ? shortBreak : longBreak);
    timerDisplay.textContent = formatTime(duration);
    localStorage.setItem('pomodoroTime', duration);
    updateProgress();
  }

  startBtn.addEventListener('click', startTimer);
  pauseBtn.addEventListener('click', pauseTimer);
  resetBtn.addEventListener('click', resetTimer);

  // Auto-start if running
  if(isRunning) startTimer();
})();
</script>
